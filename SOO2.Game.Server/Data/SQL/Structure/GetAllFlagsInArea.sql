
SELECT pctf.PCTerritoryFlagID ,
       pctf.PlayerID ,
       pctf.StructureBlueprintID ,
       pctf.LocationAreaTag ,
       pctf.LocationX ,
       pctf.LocationY ,
       pctf.LocationZ ,
       pctf.LocationOrientation ,
       pctf.BuildPrivacySettingID ,
       pctf.ShowOwnerName,
       pctf.BuildingPCStructureID,
       pctf.IsActive,
       sb.StructureBlueprintID ,
       sb.StructureCategoryID ,
       sb.Name ,
       sb.Description ,
       sb.Resref ,
       sb.IsActive ,
       sb.IsTerritoryFlag ,
       sb.IsUseable ,
       sb.ItemStorageCount ,
       sb.VanityCount ,
       sb.SpecialCount,
       sb.MaxBuildDistance ,
       sb.Level,
       sb.GivesSkillXP,
       sb.IsVanity,
       sb.IsSpecial,
       sb.CraftTierLevel,
       sb.ResourceCount,
       sb.BuildingCount,
       sb.IsResource,
       sb.IsBuilding,
       sb.ResourceResref,
       sb.BuildingCategoryID
FROM dbo.PCTerritoryFlags pctf
JOIN dbo.StructureBlueprints sb ON sb.StructureBlueprintID = pctf.StructureBlueprintID
WHERE pctf.LocationAreaTag = :areaTag
    AND pctf.IsActive = 1
ORDER BY sb.MaxBuildDistance DESC